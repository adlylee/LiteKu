<div class="col-md-12">
  <div class="panel panel-default">
    <div class="panel-heading">
      <form action="" method="">
        <div class="btn-group pull-right" style="margin-top:-8px;">
          <span class="btn btn-sm dropdown-toggle" data-toggle="dropdown">
            <i class="fa fa-calendar"></i><span class="hidden-xs"> Periode</span>
          </span>
          <ul class="dropdown-menu dropdown-menu-right">
            <li style="padding-left:5px;padding-right:5px;">
              <input type="text" id="tgl_awal" class="form-control tanggal" name="tgl_awal" value="{?=date('Y-m-d')?}"
                required>
            </li>
            <li style="padding-left:5px;padding-right:5px;margin-top:5px;">
              <input type="text" id="tgl_akhir" class="form-control tanggal" name="tgl_akhir" value="{?=date('Y-m-d')?}"
                required>
            </li>
            <li style="padding-left:5px;padding-right:5px;margin-top:5px;">
              <input type="submit" class="btn btn-primary btn-block" value="Submit">
              <input type="hidden" name="t" value="{?=$_SESSION['token']?}">
            </li>
          </ul>
        </div>
      </form>
      <h3 class="panel-title">Data Pemberian Obat Per Kategori</h3>
    </div>
    <div class="panel-body">
      <div class="table-responsive no-margin">
        <table class="table table-striped no-padding dataTables" width="100%">
          <thead>
            <tr>
              <th>No.</th>
              <th>Kode</th>
              <th>Nama Kategori</th>
              <th>Jumlah</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {if: $beriobat.list}
            {loop: $beriobat.list}
            <tr>
              <td>{$value.nomor}</td>
              <td>{$value.kode}</td>
              <td>{$value.nama}</td>
              <td>{$value.jml}</td>
              <td><a href="#" onclick="loadData(this)" data-id="{$value.kode}" data-awal="{$value.tgl_masuk}"
                  data-akhir="{$value.tgl_keluar}" class="btn btn-success btn-xs"> <span id="panah{$value.kode}"> > </span> </a></td>
            </tr>
            {/loop}
            {else}
            <tr>
              <td colspan="37" class="text-center">Tidak ada data bridging SEP.</td>
            </tr>
            {/if}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  $(".alert-dismissible").fadeTo(3000, 500).slideUp(500);
  function loadData(n) {
    awal = $(n).data("awal");
    akhir = $(n).data("akhir");
    kat = $(n).data("id");
    document.querySelector('#panah'+kat).innerHTML = "<span> x </span>";
    if ($(n).hasClass("disabled")) {
        event.preventDefault();
    }
    $(n).addClass("disabled");
    url = "{?=url([ADMIN, 'laporan', 'listobat'])?}"
    $.ajax({
      url: url,
      type: 'post',
      data: {
        awal: awal,
        akhir: akhir,
        kat: kat
      },
      success: (data) => {
        data = JSON.parse(data)
        data = data.response.list_data;
        var currTR = n.parentNode.parentNode;
        var newTR = document.createElement("td");
        var view =
        data.map((element) => {
            return element.nama + ` : <strong>` + element.jml + `</strong><br/>`;
          });
        newTR.innerHTML = view.join(" ");
        currTR.parentNode.insertBefore(newTR, currTR.nextSibling);
      }
    })
  }
</script>
<script type="text/javascript">
  $(function () {
    $('.tanggal').datetimepicker({
      format: 'YYYY-MM-DD',
      locale: 'id'
    });
  });
  $('.dataTables').DataTable({
    "order": [[3, "desc"]],
    "pagingType": "full",
    "language": {
      "paginate": {
        "first": "&laquo;",
        "last": "&raquo;",
        "previous": "‹",
        "next": "›"
      },
      "search": "",
      "searchPlaceholder": "Search..."
    },
    "lengthChange": false,
    "scrollX": true,
    dom: "<<'data-table-title'><'datatable-search'f>><'row'<'col-sm-12'tr>><<'pmd-datatable-pagination' l i p>>"
  });
  var t = $(".dataTables").DataTable().rows().count();
  $(".data-table-title").html('<h3 style="display:inline;float:left;margin-top:0;" class="hidden-xs">Total: ' + t + '</h3>');
</script>