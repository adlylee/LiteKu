<form action="{?=url(ADMIN.'/rba/savepermintaan')?}" method="POST" id="form_rba">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Input Data Permintaan Rencana Bisnis dan Anggaran</h3>
    </div>
    <div class="panel-body">
      <div class="form-horizontal">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="" class="col-sm-3 control-label">Tanggal :</label>
              <div class="col-sm-3">
                <input type="text" id="tgl_permintaan" name="tgl_permintaan" class="form-control tanggal" value="{?=date('Y-m-d')?}">
              </div>
              <div class="col-sm-5">
                <input type="text" name="jam_permintaan" placeholder="jam_permintaan" class="form-control jam" value="{?=date('H:i:s')?}">
              </div>
            </div>
            <div class="form-group">
              <label for="kd_rek" class="col-sm-3 control-label">Jenis Belanja :</label>
               <div class="col-sm-3">
                <input type="text" name="kd_rek" id="kd_rek" class="form-control" value="52" readonly>
              </div>
              <div class="col-sm-5">
                <input type="text" name="nm_rek" id="nm_rek" class="form-control" value="BELANJA MODAL" readonly>
              </div>
            </div>
            <div class="form-group">
                <label for="nama_rek" class="col-sm-3 control-label">Jenis Belanja :</label>
                <div class="col-sm-3">
                    <input type="text" name="kode_rek" id="kode_rek" class="form-control" value="" readonly>
                </div>
                <div class="col-sm-5">
                    <input type="text" name="nama_rek" id="nama_rek" class="form-control" value="">
                    <ul class="list-group" id="kode_rekList" style="z-index:1000;position:absolute;width:100%;"></ul>
                </div>
            </div>
            <div class="form-group">
                <label for="nama_rek2" class="col-sm-3 control-label">Sub :</label>
                <div class="col-sm-3">
                    <input type="text" name="kode_rek2" id="kode_rek2" class="form-control" value="" readonly>
                </div>
                <div class="col-sm-5">
                    <input type="text" name="nama_rek2" id="nama_rek2" class="form-control" value="">
                    <ul class="list-group" id="kode_rekList2" style="z-index:1000;position:absolute;width:100%;"></ul>
                </div>
            </div>
            <div class="form-group">
              <label for="saldo_berjalan" class="col-sm-3 control-label">Anggaran :</label>
              <div class="col-sm-8">
                <input type="text" name="saldo_berjalan" id="saldo_berjalan" class="form-control" placeholder="" value="" readonly>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="" class="col-sm-3 control-label">No Permintaan :</label>
              <div class="col-sm-8">
                <input type="text" name="noorder" class="form-control" placeholder="" value="{$nomor}" required readonly>
              </div>
            </div>
            <div class="form-group">
              <label for="" class="col-sm-3 control-label">Ruangan :</label>
              <div class="col-sm-2">
                <input type="text" name="kd_bangsal" id="kd_bangsal" class="form-control" value="" readonly>
              </div>
              <div class="col-sm-6">
                <input type="text" name="nm_bangsal" id="nm_bangsal" class="form-control" value="">
                <ul class="list-group" id="kd_bangsalList" style="z-index:1000;position:absolute;width:100%;"></ul>
              </div>
            </div>
            <div class="form-group">
              <label for="" class="col-sm-3 control-label">Nama Barang :</label>
              <div class="col-sm-8">
                <input type="text" name="nama_brng" class="form-control" placeholder="Nama Barang" value="">
              </div>
            </div>
            <div class="form-group">
              <label for="jumlah" class="col-sm-3 control-label">Jumlah Barang :</label>
              <div class="col-sm-3">
                <input type="text" name="jumlah" id="jumlah" class="form-control" placeholder="Jumlah" value="" required="">
              </div>
              <label for="harga" class="col-sm-2 control-label">Harga :</label>
              <div class="col-sm-3">
                <input type="text" name="harga" id="harga" class="form-control" placeholder="Harga Barang" value="">
              </div>
            </div>
            <div class="form-group">
              <label for="total" class="col-sm-3 control-label">Total :</label>
              <div class="col-sm-8">
                <input type="text" name="total" id="total" class="form-control" placeholder="Total" value="">
              </div>
            </div>
          </div>
        </div>
        <div id="notification" class="alert alert-danger" style="display: none;"></div>


        <div class="col-md-12" style="padding-top: 20px;">
          <input type="submit" name="simpan" class="btn btn-primary" value="Simpan" />
          <input type="button" name="baru" class="btn btn-success" value="Baru" onclick="location.reload();" />
          <!-- <input type="submit" name="update" class="btn btn-info" value="Update" /> -->
          <!-- <input type="submit" name="hapus" id="hapus" class="btn btn-danger pull-right" value="Hapus" /> -->
        </div>
      </div>
    </div>
  </div>
</form>
<article class="row">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <div class="btn-group pull-right" style="margin-top:-8px;">
          <span class="btn btn-sm dropdown-toggle" data-toggle="dropdown">
            <i class="fa fa-calendar"></i><span class="hidden-xs"> Periode Permintaan</span>
          </span>
          <ul class="dropdown-menu dropdown-menu-right">
             <form method="POST" action="" class="form-inline mt-3">
              <li style="padding-left:5px;padding-right:5px;">
                <input type="text" name="periode_rawat_jalan" id="periode_rawat_jalan"
                  class="form-control periode_rawat_jalan">
              </li>
              <li style="padding-left:5px;padding-right:5px;margin-top:5px;">
                <input type="text" name="periode_rawat_jalan_akhir" id="periode_rawat_jalan_akhir"
                  class="form-control periode_rawat_jalan">
              </li>
              <li style="padding-left:5px;padding-right:5px;margin-top:5px;">
                <button type="submit" name="submit" class="btn btn-primary btn-block">Cari</button>
              </li>
            </form>
          </ul>
        </div>
        <h3 class="panel-title">Data Permintaan Rencana Bisnis dan Anggaran</h3>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-md-12" id="utd_donor">
            <div class="table-responsive no-margin">
              <table class="table table-striped table-bordered no-padding nowrap" id="pardah"  width="100%">
                <thead>
                  <tr>
                    <th>No.Permintaan</th>
                    <th>Tanggal</th>
                    <th>Jam</th>
                    <th>Uraian</th>
                    <th>Ruang/Unit</th>
                    <th>Nama Barang</th>
                    <th>Jumlah</th>
                    <th>Harga</th>
                    <th>Total</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  {if: $permintaan_rba.list}
                  {loop: $permintaan_rba.list}
                  <tr>
                    <td>{$value.noorder}</td>
                    <td>{$value.tgl_permintaan}</td>
                    <td>{$value.jam_permintaan}</td>
                    <td>{$value.nm_rek}</td>
                    <td>{$value.nm_bangsal}</td>
                    <td>{$value.nama_brng}</td>
                    <td>{$value.jlh_brng}</td>
                    <td>{$value.harga_brng}</td>
                    <td>{$value.total_brng}</td>
                    <td>{$value.status}</td>
                  </tr>
                  {/loop}
                  {/if}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</article>
</div>
</div>
</div>
<script>
    $('input:text[name=nama_rek]').on('input', function (e) {
        var baseURL = mlite.url + '/' + mlite.admin;
        var url = baseURL + '/rba/belanjalist?t=' + mlite.token;
        var query = $('input:text[name=nama_rek]').val();
        var kode_rek = $('#kode_rek').val();
        if (query !== "") {
            $.ajax({
                url: url,
                method: "POST",
                data: { query: query, kode_rek: kode_rek },
                success: function (data) {
                    $('#kode_rekList').fadeIn();
                    $('#kode_rekList').html(data);
                }
            });
        } else {
            $('#kode_rekList').fadeOut();
        }
    });

    $('#kode_rekList').on('click', 'li', function () {
        $('#nama_rek').val($(this).text().split(': ')[1]);
        $('#kode_rek').val($(this).text().split(': ')[0]);
        var kode_rek = $('#kode_rek').val();
        $('#kode_rekList').fadeOut();

        $('input:text[name=nama_rek2]').trigger('input');
    });

    $('input:text[name=nama_rek2]').on('input', function (e) {
        var baseURL = mlite.url + '/' + mlite.admin;
        var url = baseURL + '/rba/sublist?t=' + mlite.token;
        var query = $('input:text[name=nama_rek2]').val();
        var kode_rek = $('#kode_rek').val();
        if (query !== "") {
            $.ajax({
                url: url,
                method: "POST",
                data: { query: query, kode_rek: kode_rek },
                success: function (data) {
                    $('#kode_rekList2').fadeIn();
                    $('#kode_rekList2').html(data);
                }
            });
        } else {
            $('#kode_rekList2').fadeOut();
        }
    });

    $('#kode_rekList2').on('click', 'li', function () {
        $('#nama_rek2').val($(this).text().split(': ')[1]);
        $('#kode_rek2').val($(this).text().split(': ')[0]);
        var kode_rek2 = $('#kode_rek2').val();
        updateAnggaran(kode_rek2);
        $('#kode_rekList2').fadeOut();
    });

 function updateAnggaran(kode_rek2) {
        var baseURL = mlite.url + '/' + mlite.admin;
        var url = baseURL + '/rba/anggaran?t=' + mlite.token;

        $.ajax({
            url: url,
            method: "POST",
            data: { kode_rek2: kode_rek2 },
            success: function (data) {
                $('#saldo_berjalan').val(data);
            }
        });
    }

</script>
<script>
  $('input:text[name=nm_bangsal]').on('input',function(e){
    var baseURL = mlite.url + '/' + mlite.admin;
    var url    = baseURL + '/rba/ruanglist?t=' + mlite.token;
    var query = $('input:text[name=nm_bangsal]').val();
    if(query!="") {
        $.ajax({
             url: url,
             method:"POST",
             data:{query:query},
             success:function(data)
             {
                  $('#kd_bangsalList').fadeIn();
                  $('#kd_bangsalList').html(data);
             }
        });
    }
    $('#kd_bangsalList').fadeIn();
  });

  $('#kd_bangsalList').on('click', 'li', function(){
       $('#nm_bangsal').val($(this).text().split(': ')[1]);
       $('#kd_bangsal').val($(this).text().split(': ')[0]);
       var kd_bangsal = $('#kd_bangsal').val();
       $('#kd_bangsalList').fadeOut();
  });
</script>
<script>
    $(document).ready(function () {
        $('#jumlah, #harga').on('input', function () {
            var jumlah = parseFloat($('#jumlah').val()) || 0;
            var harga = parseFloat($('#harga').val()) || 0;

            var total = jumlah * harga;
            $('#total').val(total.toFixed(0));

            // Check total
            var anggaran = parseFloat($('#saldo_berjalan').val()) || 0;
            if (total > anggaran) {
                // Show the notification
                $('#notification').html('Maaf, total melebihi anggaran.').show();
            } else {
                // Hide
                $('#notification').hide();
            }
        });
    });
</script>

<script type="text/javascript">
     $(function () {
      $('.tanggal').datetimepicker({
        format: 'YYYY-MM-DD',
        locale: 'id'
      });
    }); 
      $(function () {
       $('.jam').datetimepicker({
         format: 'HH:mm:ss',
         locale: 'id'
       });
   });
  </script>
  <script type="text/javascript">
  $(function () {
    $('.periode_rawat_jalan').datetimepicker({
      defaultDate: '{?=date('Y-m-d')?}',
      format: 'YYYY-MM-DD',
      locale: 'id'
         });
     });
</script>
