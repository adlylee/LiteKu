<article class="row" id="display">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <!-- <div class="btn-group pull-right" style="margin-top:-8px;">
                  <span class="btn btn-sm dropdown-toggle" data-toggle="dropdown">
                    <i class="fa fa-calendar"></i><span class="hidden-xs"> Pilihan dan Pemilahan</span>
                  </span>
                  <ul class="dropdown-menu dropdown-menu-right">
                    <form class="" action="{?=url(ADMIN.'/vedika/index')?}" method="">
                    <li style="padding-left:5px;padding-right:5px;">
                      <input type="text" id="start_date" class="form-control tanggal" name="start_date" required>
                    </li>
                    <li style="padding-left:5px;padding-right:5px;margin-top:5px;">
                      <input type="text" id="end_date" class="form-control tanggal" name="end_date" required>
                    </li>
                    <li class="{if: $tab == 'ralan'}active{/if}" style="padding-left:5px;padding-right:5px;margin-top:5px;">
                        <a href="{$vedika.ralanUrl}" class="btn btn-primary btn-block" role="tab">Rawat Jalan</a>
                    </li>
                    <li class="{if: $tab == 'ranap'}active{/if}" style="padding-left:5px;padding-right:5px;margin-top:5px;">
                        <a href="{$vedika.ranapUrl}" class="btn btn-primary btn-block" role="tab">Rawat Inap</a>
                    </li>
                    <li style="padding-left:5px;padding-right:5px;margin-top:5px;">
                      <input type="submit" name="submit" class="btn btn-primary btn-block" value="Submit">
                      <input type="hidden" name="t" value="{?=$_SESSION['token']?}">
                    </li>
                    </form>
                  </ul>
                </div> -->
                <h3 class="panel-title">Kelola e-SL III</h3>
            </div>
            <div class="panel-body">
                <div class="row clearfix">
                  <div class="col col-md-6">
                    <h3 style="margin-top:5px;margin-bottom:15px;">Jumlah: {?=count($vedika.totalRecords)?}</h3>
                  </div>
                  <div class="col col-md-6">
                    <form action="{$vedika.searchUrl}" class="searchbox-input form-inline pull-right padding-bottom-lg" style="margin-top:5px;margin-bottom:15px;">
                        <div class="input-group">
                            <input type="text" name="s" minlength="3" class="form-control" placeholder="Search" required>
                            <input type="hidden" name="start_date" value="{if: isset($_GET['start_date'])}{?=$_GET['start_date']?}{else}{?=date('Y-m-d')?}{/if}">
                            <input type="hidden" name="end_date" value="{if: isset($_GET['end_date'])}{?=$_GET['end_date']?}{else}{?=date('Y-m-d')?}{/if}">
                            <input type="hidden" name="t" value="{?=$_SESSION['token']?}">
                            <span class="input-group-btn">
                                <button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search"></span></button>
                            </span>
                        </div>
                    </form>
                  </div>
                </div>
      					<div class="table-responsive no-margin">
      						<table class="table table-striped no-margin">
      							<thead>
      								<tr>
                        <th>Aksi dan Proses</th>
                        <th>Data Pasien</th>
                        <th>Keterangan</th>
                        <th>Data Kunjungan</th>
      								</tr>
      							</thead>
      							<tbody>
              			{if: !empty($vedika.list)}
      								{loop: $vedika.list}
      								<tr>
                        <td>
                          
                            <button class="btn btn-info btn-xs">
                              <i class="fa fa-file-o"></i> {$value.no_sep}
                            </button>
                          <br/>
                          <a href="{$value.pdfURL}" target="_blank" class="btn btn-primary btn-xs">
      						<i class="fa fa-print"></i> Lihat Data Klaim
      				     </a>
                          <br/>
                          {if: $value.no_sep == ''}
                            <button class="btn btn-warning btn-xs">
        											<i class="fa fa-check"></i> Status
        										</button><br>
                          {else}
                            <!-- <a href="{$value.setstatusURL}" class="btn btn-success btn-xs" data-toggle="modal" data-target="#statusModal">
        											<i class="fa fa-check"></i> Status
        										</a> -->
                            {loop: $value.status_pengajuan as $data}
                            <span class="badge badge-{if: $data.status == 'Setuju'}success{elseif: $data.status == 'Perbaiki'}error{else}warning{/if}">{$data.status}</span>
                            {/loop}
                            <br>
                            {if: $this->core->getUserInfo('role') == 'admin' || $value.isubahresume == true}
                            <a href="{$value.ubahresume}" class="btn btn-info btn-xs" data-toggle="modal" data-target="#modalResume">
                              <i class="fa fa-pencil"></i> Ubah Resume
                            </a>
                            {/if}
                            <br>
                            <a href="#" class="btn {if: $value.sl == 'false'}btn-success sltiga{else}btn-danger sltigabatal{/if} btn-xs" id="{?=convertNorawat($value.no_rawat)?}" data-no_rawat="{?=convertNorawat($value.no_rawat)?}" data-nm_pasien = "{$value.nm_pasien}">
                              <i class="fa fa-pencil"></i> SL III
                            </a>
                            <br>
                            <a href="#" class="btn btn-warning btn-xs verif_sl" data-id_sl="{$value.id}" data-nm_pasien = "{$value.nm_pasien}">
                              <i class="fa fa-check"></i> Verifikasi SL III
                            </a>
                          {/if}
                        </td>
      									<td>
                          <table>
                            <tr>
                              <td width='120px'>No.Rawat</td><td>: {$value.no_rawat}</td>
                            </tr>
                            <tr>
                              <td width='120px'>No.RM</td><td>: {$value.no_rkm_medis}</td>
                            </tr>
                            <tr>
                              <td width='120px'>Nama Pasien</td><td>: {$value.nm_pasien}</td>
                            </tr>
                            <tr>
                              <td width='120px'>Umur</td><td>: {$value.umur} {$value.sttsumur}</td>
                            </tr>
                            <tr>
                              <td width='120px'>Jenis Kelamin</td><td>: {if: $value.jk == 'L'}Laki-Laki{else}Perempuan{/if}</td>
                            </tr>
                            <tr>
                              <td width='120px'>Alamat Pasien</td><td>: {?=substr($value.almt_pj, 0, strrpos(substr($value.almt_pj, 0, 20), ' '))?}</td>
                            </tr>
                            <tr>
                              <td width='120px'>Kamar</td><td>: {$value.nm_poli}</td>
                            </tr>
                          </table>
                        </td>
                        <td>
                          <table>
                            <tr>
                              <td>Status</td><td>: {$value.status_sl}</td>
                            </tr>
                            <tr>
                              <td>Keterangan</td><td>: {$value.keterangan}</td>
                            </tr>
                          </table>
                        </td>
                        <td>
                          <table>
                            <tr>
                              <td width='120px'>No. Kunjungan</td><td>: {$value.no_rujukan}</td>
                            </tr>
                            <tr>
                              <td width='120px'>No. Kartu</td><td>: {$value.no_peserta}</td>
                            </tr>
                            <tr>
                              <td width='120px'>Diagnosa</td><td>{loop: $value.diagnosa_penyakit as $pdx} {$pdx.kd_penyakit} {$pdx.nm_penyakit}<br>{/loop}</td>
                            </tr>
                            <tr>
                              <td width='120px'></td><td>--------------------------------------------------</td>
                            </tr>
                            <tr>
                              <td width='120px'>Prosedur</td><td>{loop: $value.prosedur as $ppx} {$ppx.kode}  {$ppx.deskripsi_panjang} <br> {/loop}</td>
                            </tr>
                          </table>
                        </td>
      								</tr>
      								{/loop}
      								{else}
      								<tr><td colspan="5" class="text-center">Data pasien tidak ditemukan</td></tr>
      							{/if}
      							</tbody>
      						</table>
      					</div>
                {$vedika.pagination}
            </div>
        </div>
    </div>
</article>
<!-- Modal -->
<div class="modal fade" id="moduleModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" style="width:1120px;" role="document">
        <div class="modal-content">
            ...
        </div>
    </div>
</div>
<div class="modal fade" id="modalResume" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" style="width:1120px;" role="document">
      <div class="modal-content">
          ...
      </div>
  </div>
</div>
<div class="modal fade" id="statusModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            ...
        </div>
    </div>
</div>
<script type="text/javascript">
  var no_rawat = $(this).attr("data-no_rawat");
  $('input:text[name=no_rawat]').val(no_rawat);
</script>
<script>
  $( function() {
    $('.tanggal').datetimepicker({
      defaultDate: '{?=date('Y-m-d')?}',
      format: 'YYYY-MM-DD',
      locale: 'id'
    });
  } );
  $('.gallery').lightbox();
</script>
<script type="text/javascript">
  $("#display").on("click",".sltiga", function(event){
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();
    var no_rawat = $(this).attr("data-no_rawat");
    var nm_pasien = $(this).attr("data-nm_pasien");
    var loadURL =  baseURL + '/vedika/setsltiga?t=' + mlite.token;

    bootbox.confirm("Apakah Anda ingin menambahkan SL III untuk pasien ini?", function(result){
      if (result){
        $.post(loadURL, {
          no_rawat: no_rawat
        } ,function(data) {
          console.log(data);
          if (data == 201) {
            alert('Data pasien ' + nm_pasien + ' sudah ditambahkan SL III!!');
            document.getElementById(no_rawat).classList.remove('sltiga');
            document.getElementById(no_rawat).classList.remove('btn-success');

            document.getElementById(no_rawat).classList.add('sltigabatal');
            document.getElementById(no_rawat).classList.add('btn-danger');
          } else {
            alert('Data pasien ' + nm_pasien + ' gagal ditambahkan SL III!!');
          }
        });
      }
    });
  });
</script>
<script type="text/javascript">
  $("#display").on("click",".sltigabatal", function(event){
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();
    var no_rawat = $(this).attr("data-no_rawat");
    var nm_pasien = $(this).attr("data-nm_pasien");
    var loadURL =  baseURL + '/vedika/batalsltiga?t=' + mlite.token;

    bootbox.confirm("Apakah Anda ingin membatalkan SL III untuk pasien ini?", function(result){
      if (result){
        $.post(loadURL, {
          no_rawat: no_rawat
        } ,function(data) {
          console.log(data);
          if (data == 201) {
            alert('Data pasien ' + nm_pasien + ' sudah dibatalkan SL III!!');
            document.getElementById(no_rawat).classList.add('sltiga');
            document.getElementById(no_rawat).classList.add('btn-success');

            document.getElementById(no_rawat).classList.remove('sltigabatal');
            document.getElementById(no_rawat).classList.remove('btn-danger');
          } else {
            alert('Data pasien ' + nm_pasien + ' gagal dibatalkan SL III!!');
          }
        });
      }
    });
  });
</script>
<script type="text/javascript">
  $("#display").on("click",".verif_sl", function(event){
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();
    var id_sl = $(this).attr("data-id_sl");
    var nm_pasien = $(this).attr("data-nm_pasien");
    var loadURL =  baseURL + '/vedika/verifsltiga?t=' + mlite.token;

    bootbox.confirm("Apakah Anda ingin memverifikasi SL III untuk pasien ini?", function(result){
      if (result){
        $.post(loadURL, {
          id_sl: id_sl
        } ,function(data) {
          console.log(data);
          if (data == 200) {
            alert('Data pasien ' + nm_pasien + ' sudah diverifikasi untuk SL III!!');
          } else {
            alert('Data pasien ' + nm_pasien + ' gagal diverifikasi untuk SL III!!');
          }
        });
      }
    });
  });
</script>