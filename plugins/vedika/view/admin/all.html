
<style>
    .dataTables_wrapper th, td { white-space: nowrap; }
    .datatable-search input {padding:18px 10px;}
</style>
<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Kelola</h3>
        <ul class="nav nav-tabs">
            <li class="{if: $tab == ''}active{elseif: $tab == 'Ralan'}active{/if}">
              <a href="{?=url([ADMIN,'vedika','all','Ralan'])?}" role="tab">Rawat Jalan</a>
            </li>
            <li class="{if: $tab == 'Ranap'}active{/if}">
              <a href="{?=url([ADMIN,'vedika','all','Ranap'])?}" role="tab">Rawat Inap</a>
            </li>
        </ul>
      </div>
      <div class="panel-body">
        <div class="table-responsive">      
          <table class="table table-striped table-sm">
            <thead>
              <tr>
                <th style="white-space: nowrap;">Aksi</th>
                <th style="white-space: nowrap;">No. RM</th>
                <th style="white-space: nowrap;">Nama Pasien</th>
                <th style="white-space: nowrap;">ID Kunjungan</th>
                {if: $tab == 'Ralan'}
                  <th style="white-space: nowrap;">Antrian</th>
                  <th style="white-space: nowrap;">Poliklinik</th>
                {else}
                  <th style="white-space: nowrap;">Kamar</th>
                  <th style="white-space: nowrap;">Bangsal</th>
                {/if}
                <th style="white-space: nowrap;">Dokter</th>
                <th style="white-space: nowrap;">Penjamin</th>
                <th style="white-space: nowrap;">No. Asuransi</th>
                {if: $tab == 'Ralan'}
                  <th style="white-space: nowrap;">Tgl. Kunjungan</th>
                {else}
                  <th style="white-space: nowrap;">Tgl. Masuk</th>
                {/if}
                <th style="white-space: nowrap;">Stts. Periksa</th>
                <th style="white-space: nowrap;">Stts. Lanjut</th>
                <th style="white-space: nowrap;">Stts. Bayar</th>
              </tr>
            </thead>
            <tbody>
              <!-- List Data Menggunakan DataTable -->             
            </tbody>
          </table>
        </div>
      </div>    
    </div>
  </div>
</div>

    <div class="modal fade" id="asuransiModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                ...
            </div>
        </div>
    </div>
    <div class="modal fade" id="statusModal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
          <div class="modal-content">
              ...
          </div>
      </div>
    </div>
  
<script>
   
  $(function(){
       $(".datepicker").datetimepicker({
        format: 'YYYY-MM-DD',
        locale: 'id'
       });

       var rawat_jalan_recordsTotal = '';
       var dtable = $('.table').DataTable({
          "processing": true,
          "serverSide": true,
          "ajax":{
              // "url": "{?=url()?}/{?=ADMIN?}/vedika/alldata?t={?=$_SESSION['token']?}",
              "url": "{?=url([ADMIN, 'vedika', 'alldata', $tab])?}",
              "dataType": "json",
              "type": "POST", 
              'data': function(data){
                  // Read values
                  var from_date = $('#tanggal_awal').val();
                  var to_date = $('#tanggal_akhir').val();
                  var sortByUnit = $('#sortByUnit').val();
                  var sortByDokter = $('#sortByDokter').val();

                  // Append to data
                  data.searchByFromdate = from_date;
                  data.searchByTodate = to_date;
                  data.sortByUnit = sortByUnit;
                  data.sortByDokter = sortByDokter;
              }                
          },
          "initComplete": function() {
            var $searchInput = $('div.dataTables_filter input');
            $searchInput.unbind();
            $searchInput.bind('keyup', function(e) {
                if(this.value.length > 2) {
                    dtable.search( this.value ).draw();
                }
                if(this.value == '') {
                    dtable.search('').draw();
                }
            });           
          }, 
          "fnDrawCallback": function () {
            $('.selectator').selectator();
          },           
          "columns": [
            { "data": "aksi" }, 
            { "data": "no_rkm_medis" },
            { "data": "nm_pasien" },
            { "data": "no_rawat" },
            {if: $tab == 'Ralan'}
              { "data": "no_reg" },
              { "data": "nm_poli" },
            {else}
              { "data": "kd_kamar" },
              { "data": "nm_bangsal" },
            {/if}
            { "data": "nm_dokter" },
            { "data": "png_jawab" },
            { "data": "no_peserta" },
            {if: $tab == 'Ralan'}
              { "data": "tgl_registrasi" },
              { "data": "stts" },
            {else}
              { "data": "tgl_masuk" },
              { "data": "stts_pulang" },
            {/if}
            { "data": "status_lanjut" },
            { "data": "status_bayar" }
          ], 
          "language": {
          "paginate": {
            "first": "&laquo;",
            "last": "&raquo;",
            "previous": "‹",
            "next":     "›"
          },
          "search": "",
          "searchPlaceholder": "Pencarian..."
          },
          "lengthChange": false,
          "scrollX": true,
          dom: "<<'data-table-title'><'datatable-search'f>><'row'<'col-sm-12'tr>><<'pmd-datatable-pagination' l i p>>"
      });
      // var t = localStorage.getItem('rawat_jalan_recordsTotal');
      $(".data-table-title").html('<div style="display:inline;float:left;margin-top:0;">'+
        '<select class="form-control selectator" id="sortByUnit"> '+
        '<option value="">{if: $tab == 'Ralan'}Poli/Unit{else}Bangsal/Ruangan{/if}</option> '+
        '{loop: $unit}'+
        '<option value="{$value.kode}">{$value.nama}</option> '+
        '{/loop}'+
        '</select> '+
        '<select class="form-control selectator" id="sortByDokter"> '+
        '<option value="">Dokter PJP</option> '+
        '{loop: $dokter}'+
        '<option value="{$value.kd_dokter}">{$value.nm_dokter}</option> '+
        '{/loop}'+
        '</select> '+
        '<input type="date" class="form-control" id="tanggal_awal" placeholder="Tanggal Awal"> '+
        '<input type="date" class="form-control" id="tanggal_akhir" placeholder="Tanggal Awal"> '+
        '<input type="button" class="btn btn-primary" id="btn_search" value="OK"> '+
        '</div>');

      $('#btn_search').click(function(){
        dtable.draw();
      });      
      $('#sortByUnit, #sortByDokter').bind("keyup change", function(){
        dtable.draw();
      });   
    });

</script>
