<div class="row" id="set_batalklaim" style="margin-bottom:100px;">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <ul class="nav nav-tabs">
          <li>
            <a href="{?=url([ADMIN,'rawat_inap','resume_siapklaim'])?}" role="tab">Siap Klaim</a>
          </li>
          <li class="active">
            <a href="{?=url([ADMIN,'rawat_inap','resume_batalset'])?}" role="tab">Batal Klaim</a>
          </li>
          <li>
            <a href="{?=url([ADMIN,'rawat_inap','manage_listpulang'])?}" role="tab">Belum Resume</a>
          </li>
        </ul>
        <div class='panel-title pull-right' style="padding-right: 335px">
          <div class="btn-group pull-right" style="margin-top:-2px;">
            <span class="btn btn-sm dropdown-toggle" data-toggle="dropdown">
              <i class="fa fa-calendar"></i><span class="hidden-xs"> Periode Pulang</span>
            </span>
            <ul class="dropdown-menu dropdown-menu-right">
              <form method="POST" action="" class="form-inline mt-3">
                <li style="padding-left:5px;padding-right:5px;">
                  <input type="date" name="periode_pulang" id="periode_pulang"  class="form-control shadow-sm border-left-primary" required>
                </li>
                <li style="padding-left:5px;padding-right:5px;margin-top:5px;">
                  <input type="date" name="periode_pulang_akhir" id="periode_pulang_akhir"  class="form-control shadow-sm border-left-primary" required>
                </li>
                <li style="padding-left:5px;padding-right:5px;margin-top:5px;">
                  <button type="submit" name="submit" class="btn btn-primary btn-block">Pulang</button>
                </li>
              </form>
            </ul>
          </div>
        </div>
        <h3 class="panel-title">
          Set Batal Klaim
        </h3>
      </div>
      <div class="panel-body">
        <div class="row">
          <div id="notif"></div>
        </div>
        <div class="batalset">
          <div id="batalset">
            <div class="table-responsive no-margin">
              <table class="table table-striped no-padding dataTables" width="100%">
                <thead>
                  <tr>
                    <th style="white-space: nowrap;">Set Klaim</th>
                    <th style="white-space: nowrap;">No. RM</th>
                    <th style="white-space: nowrap;">Nama Pasien</th>
                    <th style="white-space: nowrap;">Nomor Rawat</th>
                    <th style="white-space: nowrap;">Bangsal/Kamar</th>
                    <th style="white-space: nowrap;">DPJP</th>
                    <th style="white-space: nowrap;">Telah Diresume Oleh Dokter</th>
                    <th style="white-space: nowrap;">Tgl. Masuk</th>
                    <th style="white-space: nowrap;">Tgl. Keluar</th>
                  </tr>
                </thead>
                <tbody>
                  {loop: $setbatal.list}
                  <tr{if: $value.ket_dilanjutkan=='Selesai' } style="background-color: #dff0d8 !important;" {/if}>
                    <td style="white-space: nowrap;">
                      <a href="#toggle-button" data-no_rawat="{$value.no_rawat}" data-ket_keluar="{$value.ket_keluar}"
                        class="btn btn-xs btn-danger toggle-button">
                        <i class="fa fa-edit"></i> <span class="button-text"> Batal Set</span>
                      </a>
                    </td>
                    <td style="white-space: nowrap;">{$value.no_rkm_medis}</td>
                    <td style="white-space: nowrap;">{$value.nm_pasien}</td>
                    <td style="white-space: nowrap;"><a href="#resume_ranap"
                        data-no_rawat="{$value.no_rawat}">{$value.no_rawat}</a></td>
                    <td class="edit" data-no_rawat="{$value.no_rawat}" style="white-space: nowrap;">{$value.nm_bangsal}
                      - {$value.kd_kamar}</td>
                    <td style="white-space: nowrap;">
                      <ul class="list-unstyled">
                        {if: $value.dokter}
                        {loop: $value.dokter as $data_dokter}
                        <li>
                          <span class="fa fa-minus-square-o hapus_dpjp" data-no_rawat="{$value.no_rawat}"
                            data-kd_dokter="{$data_dokter.kd_dokter}"></span> {$data_dokter.nm_dokter} (
                          {$data_dokter.jenis_dpjp} )
                        </li>
                        {/loop}
                        {else}
                        <li>-----</li>
                        {/if}
                      </ul>
                    </td>
                    <td style="white-space: nowrap;">{if: $value.ket_keadaan !=''}{$value.dpjp_resume}{else} <span
                        class="fa fa-minus-square-o"></span> {$value.namadok}{/if}</td>
                    <td style="white-space: nowrap;">{$value.tgl_masuk} {$value.jam_masuk}</td>
                    <td style="white-space: nowrap;">{$value.tgl_keluar} {$value.jam_keluar}</td>

                    </tr>
                    {/loop}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="asuransiModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      ...
    </div>
  </div>
</div>
<div class="modal fade" id="riwayatModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-full" role="document">
    <div class="modal-content">
      ...
    </div>
  </div>
</div>
<div class="modal fade" id="rad" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      ...
    </div>
  </div>
</div>
<script type="text/javascript">
  $(function () {
    $('.periode_pulang').datetimepicker({
      defaultDate: '{?=date('Y-m-d')?}',
      format: 'YYYY-MM-DD',
      locale: 'id'
         });
     });
</script>
<script type="text/javascript">
$(document).ready(function() {
    $('.toggle-button').click(function(event) {
        event.preventDefault();
        var baseURL = mlite.url + '/' + mlite.admin;
        var url;
        var no_rawat = $(this).attr("data-no_rawat");
        var ket_keluar = $(this).attr("data-ket_keluar");
        var button = $(this);
        var buttonText = button.find('.button-text');

        // Cek status tombol
        if (ket_keluar === "") {
            url = baseURL + '/rawat_inap/setsiapklaim?t=' + mlite.token;
            bootbox.confirm("Apakah resume ini ingin diteruskan ke Rekam Medis?", function(result) {
                if (result) {
                    $.post(url, {
                        no_rawat: no_rawat
                    }, function(data) {
                      // button.closest('tr').remove();
                        // Update status tombol menjadi "Batal Set"
                        button.attr("data-ket_keluar", "Siap Klaim");
                        buttonText.text("Batal Set");
                        button.addClass('btn-danger');
                        button.removeClass('btn-info');
                        $('#notif').html("<div class=\"alert alert-success alert-dismissible fade in\" role=\"alert\" style=\"border-radius:0px;margin-top:-15px;\">"+
                            "Status Resume Pasien telah Diteruskan!"+
                            "<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">&times;</button>"+
                            "</div>").show();
                    });
                }
            });
        } else {
            url = baseURL + '/rawat_inap/hapus_setsiapklaim?t=' + mlite.token;
            bootbox.confirm("Apakah resume ingin dibatalkan?", function(result) {
                if (result) {
                    $.post(url, {
                        no_rawat: no_rawat
                    }, function(data) {
                        // Update status tombol menjadi "Siap Klaim"
                        // button.attr("data-ket_keluar", "");
                        // buttonText.text("Siap Klaim");
                        // button.removeClass('btn-danger');
                        // button.addClass('btn-info');
                        button.closest('tr').remove(); 
                        $('#notif').html("<div class=\"alert alert-success alert-dismissible fade in\" role=\"alert\" style=\"border-radius:0px;margin-top:-15px;\">"+
                            "Resume Pasien telah dibatalkan!"+
                            "<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">&times;</button>"+
                            "</div>").show();
                    });
                }
            });
        }
    });
});
</script>
<!-- <script type="text/javascript">
$(document).on('click', '.toggle-button', function (event) {
  event.preventDefault();
  var baseURL = mlite.url + '/' + mlite.admin;
  var url;
  var no_rawat = $(this).attr("data-no_rawat");
  var ket_keluar = $(this).attr("data-ket_keluar");
  var button = $(this);
  var buttonText = button.find('.button-text');

  url = baseURL + '/rawat_inap/hapus_setsiapklaim?t=' + mlite.token;
  bootbox.confirm("Apakah resume ingin dibatalkan?", function (result) {
    if (result) {
      $.post(url, {
        no_rawat: no_rawat
      }, function (data) {
        button.closest('tr').remove(); // Remove the row from the table
        $('#notif').html("<div class=\"alert alert-success alert-dismissible fade in\" role=\"alert\" style=\"border-radius:0px;margin-top:-15px;\">" +
          "Resume Pasien telah dibatalkan!" +
          "<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">&times;</button>" +
          "</div>").show();
      });
    }
  });
});

</script> -->

<script type="text/javascript">
  $('a[href="#resume_ranap"]').click(function (event) {
    var baseURL = mlite.url + '/' + mlite.admin;
    event.preventDefault();
    var url = baseURL + '/rawat_inap/resume?t=' + mlite.token;
    var no_rawat = $(this).attr("data-no_rawat");
    // tampilkan dialog konfirmasi
    console.log(no_rawat);
    var loadURL = baseURL + '/rawat_inap/resume?no_rawat=' + no_rawat + '&t=' + mlite.token;

    window.open(loadURL, '_blank');
  });
</script>
<script type="text/javascript">
  $(".alert-dismissible").fadeTo(3000, 500).slideUp(500);
  $('.dataTables').DataTable({
    "order": [[7, "asc"]],
    "pagingType": "full",
    "language": {
      "paginate": {
        "first": "&laquo;",
        "last": "&raquo;",
        "previous": "‹",
        "next": "›"
      },
      "search": "",
      "searchPlaceholder": "Search..."
    },
    "lengthChange": false,
    "scrollX": true,
    dom: "<<'data-table-title'><'datatable-search'f>><'row'<'col-sm-12'tr>><<'pmd-datatable-pagination' l i p>>"
  });
  var t = $(".dataTables").DataTable().rows().count();
  $(".data-table-title").html('<h3 style="display:inline;float:left;margin-top:0;" class="hidden-xs">Total: ' + t + '</h3>');
</script>
<script type="text/javascript">
  $(function () {
    $('.tanggal').datetimepicker({
      format: 'YYYY-MM-DD',
      locale: 'id'
    });
  }); 
</script>
<script>
  $('body').on('hidden.bs.modal', '.modal', function () {
    $(this).removeData('bs.modal');
  });
</script>